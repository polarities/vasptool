import os


class INCAR(dict):
    def set_tag(self, tag, value):
        self.update({tag:value})

    def save_incar(self, path):
        docpath = os.path.join(path, "INCAR")
        for k in self.keys():
            if self.validate(k) is False:
                raise ValueError(f"Key '{k}' is not valid INCAR keyword. Revise your input.")

        with open(docpath, 'w') as file:
            file.write(f"general:\n")
            for key, value in self.items():
                if type(value) == bool:
                    if value is True:
                        value = 'T'
                    elif value is False:
                        value = 'F'
                    else:
                        raise ValueError("Boolean looks weird. I quit!")
                if type(value) != str:
                    value = str(value)
                file.write(f"{key} = {value}\n")

    def __setitem__(self, key, value):
        if self.validate(key) is False:
            raise ValueError(f"Key '{key}' is not valid INCAR keyword.")

        super(INCAR, self).__setitem__(key, value)

    def validate(self, key):
        valid_list = [
            'ADDGRID',
            'AEXX',
            'AGGAC',
            'AGGAX',
            'ALDAC',
            'ALGO',
            'AMIN',
            'AMIX',
            'AMIX_MAG',
            'ANDERSEN_PROB',
            'ANTIRES',
            'APACO',
            'BMIX',
            'BMIX_MAG',
            'BPARAM',
            'CH_LSPEC',
            'CH_NEDOS',
            'CH_SIGMA',
            'CLL',
            'CLN',
            'CLNT',
            'CLZ',
            'CMBJ',
            'CMBJA',
            'CMBJB',
            'CPARAM',
            'CSHIFT',
            'CUTOFF_MU',
            'CUTOFF_SIGMA',
            'CUTOFF_TYPE',
            'DEPER',
            'DIMER_DIST',
            'DIPOL',
            'DQ',
            'EBREAK',
            'EDIFF',
            'EDIFFG',
            'EFIELD',
            'EFIELD_PEAD',
            'EINT',
            'EMAX',
            'EMIN',
            'ENAUG',
            'ENCUT',
            'ENCUTFOCK',
            'ENCUTGW',
            'ENCUTGWSOFT',
            'ENINI',
            'EPSILON',
            'ESTOP',
            'EVENONLY',
            'EVENONLYGW',
            'FERDO',
            'FERWE',
            'FINDIFF',
            'FOCKCORR',
            'GGA',
            'GGA_COMPAT',
            'HFALPHA',
            'HFLMAX',
            'HFRCUT',
            'HFSCREEN',
            'HILLS_BIN',
            'HILLS_H',
            'HILLS_W',
            'HITOLER',
            'I_CONSTRAINED_M',
            'IALGO',
            'IALL_IN_ONE',
            'IBAND',
            'IBRION',
            'ICHARG',
            'ICHIBARE',
            'ICORELEVEL',
            'IDIPOL',
            'IEPSILON',
            'IGPAR',
            'IMAGES',
            'IMIX',
            'INCREM',
            'INIMIX',
            'INIWAV',
            'IPEAD',
            'ISIF',
            'ISMEAR',
            'ISPIN',
            'ISTART',
            'ISYM',
            'IVDW',
            'IWAVPR',
            'KBLOCK',
            'KGAMMA',
            'KPAR',
            'KPOINT_BSE',
            'KPOINTS_OPT_NKBATCH',
            'KPUSE',
            'KSPACING',
            'LADDER',
            'LAECHG',
            'LALL_IN_ONE',
            'LAMBDA',
            'LANGEVIN_GAMMA',
            'LANGEVIN_GAMMA_L',
            'LASPH',
            'LASYNC',
            'LATTICE_CONSTRAINTS',
            'LBERRY',
            'LBLUEOUT',
            'LBONE',
            'LCALCEPS',
            'LCALCPOL',
            'LCHARG',
            'LCHARGH5',
            'LCHIMAG',
            'LCORR',
            'LDAU',
            'LDAUJ',
            'LDAUL',
            'LDAUPRINT',
            'LDAUTYPE',
            'LDAUU',
            'LDIAG',
            'LDIPOL',
            'LDISENTANGLE',
            'LEFG',
            'LELF',
            'LEPSILON',
            'LFINITE_TEMPERATURE',
            'LFOCKACE',
            'LFOCKAEDFT',
            'LFXC',
            'LH5',
            'LHARTREE',
            'LHFCALC',
            'LHYPERFINE',
            'LIBXC1',
            'LIBXC1_Pn',
            'LIBXC2',
            'LIBXC2_Pn',
            'LKPOINTS_OPT',
            'LKPOINTS_WAN',
            'LKPROJ',
            'LLRAUG',
            'LMAXFOCK',
            'LMAXFOCKAE',
            'LMAXMIX',
            'LMAXPAW',
            'LMAXTAU',
            'LMIXTAU',
            'LMODELHF',
            'LMONO',
            'LMP2LT',
            'LNABLA',
            'LNMR_SYM_RED',
            'LNONCOLLINEAR',
            'LOCPROJ',
            'LOPTICS',
            'LORBIT',
            'LORBMOM',
            'LPARD',
            'LPEAD',
            'LPHON_DISPERSION',
            'LPHON_POLAR',
            'LPHON_READ_FORCE_CONSTANTS',
            'LPLANE',
            'LREAL',
            'LRPA',
            'LRPAFORCE',
            'LSCAAWARE',
            'LSCALAPACK',
            'LSCALER0',
            'LSCALU',
            'LSCDM',
            'LSCK',
            'LSCSGRAD',
            'LSELFENERGY',
            'LSEPB',
            'LSEPK',
            'LSMP2LT',
            'LSORBIT',
            'LSPECTRAL',
            'LSPECTRALGW',
            'LSPIRAL',
            'LSUBROT',
            'LTBOUNDLIBXC',
            'LTEMPER',
            'LTHOMAS',
            'LTRIPLET',
            'LUSE_VDW',
            'LUSENCCL',
            'LVDW_EWALD',
            'LVDW_ONECELL',
            'LVDWEXPANSION',
            'LVDWSCS',
            'LVHAR',
            'LVTOT',
            'LWANNIER90',
            'LWANNIER90_RUN',
            'LWAVE',
            'LWAVEH5',
            'LWEIGHTED',
            'LWRITE_MMN_AMN',
            'LWRITE_UNK',
            'LWRITE_WANPROJ',
            'LZEROZ',
            'M_CONSTR',
            'MAGMOM',
            'MAXMEM',
            'MAXMIX',
            'MDALGO',
            'METAGGA',
            'MINROT',
            'MIXPRE',
            'ML_AFILT2',
            'ML_CDOUB',
            'ML_CSIG',
            'ML_CSLOPE',
            'ML_CTIFOR',
            'ML_CX',
            'ML_EATOM_REF',
            'ML_EPS_LOW',
            'ML_EPS_REG',
            'ML_IAFILT2',
            'ML_IALGO_LINREG',
            'ML_ICOUPLE',
            'ML_ICRITERIA',
            'ML_IERR',
            'ML_IREG',
            'ML_ISCALE_TOTEN',
            'ML_ISTART',
            'ML_IWEIGHT',
            'ML_LAFILT2',
            'ML_LBASIS_DISCARD',
            'ML_LCOUPLE',
            'ML_LEATOM',
            'ML_LERR',
            'ML_LFAST',
            'ML_LHEAT',
            'ML_LMAX2',
            'ML_LMLFF',
            'ML_LSPARSDES',
            'ML_MB',
            'ML_MCONF',
            'ML_MCONF_NEW',
            'ML_MHIS',
            'ML_MODE',
            'ML_MRB1',
            'ML_MRB2',
            'ML_NATOM_COUPLED',
            'ML_NHYP',
            'ML_NMDINT',
            'ML_NRANK_SPARSDES',
            'ML_OUTBLOCK',
            'ML_OUTPUT_MODE',
            'ML_RCOUPLE',
            'ML_RCUT1',
            'ML_RCUT2',
            'ML_RDES_SPARSDES',
            'ML_SCLC_CTIFOR',
            'ML_SIGV0',
            'ML_SIGW0',
            'ML_SION1',
            'ML_SION2',
            'ML_W1',
            'ML_WTIFOR',
            'ML_WTOTEN',
            'ML_WTSIF',
            'NATURALO',
            'NBANDS',
            'NBANDS_WAVE',
            'NBANDSEXACT',
            'NBANDSGW',
            'NBANDSO',
            'NBANDSV',
            'NBLK',
            'NBLOCK',
            'NBMOD',
            'NBSEEIG',
            'NCORE',
            'NCORE_IN_IMAGE1',
            'NCRPA_BANDS',
            'NEDOS',
            'NELECT',
            'NELM',
            'NELMDL',
            'NELMGW',
            'NELMIN',
            'NFREE',
            'NGX',
            'NGXF',
            'NGY',
            'NGYF',
            'NGYROMAG',
            'NGZ',
            'NGZF',
            'NKRED',
            'NKREDX',
            'NKREDY',
            'NKREDZ',
            'NLSPLINE',
            'NMAXFOCKAE',
            'NMAXFOCKAE_and_LMAXFOCKAE',
            'NOMEGA',
            'NOMEGA_DUMP',
            'NOMEGAPAR',
            'NOMEGAR',
            'NPACO',
            'NPAR',
            'NPPSTR',
            'NRMM',
            'NSIM',
            'NSTORB',
            'NSUBSYS',
            'NSW',
            'NTARGET_STATES',
            'NTAUPAR',
            'NTEMPER',
            'NUM_WANN',
            'NUPDOWN',
            'NWRITE',
            'ODDONLY',
            'ODDONLYGW',
            'OFIELD_A',
            'OFIELD_KAPPA',
            'OFIELD_Q6_FAR',
            'OFIELD_Q6_NEAR',
            'OMEGAMAX',
            'OMEGAMIN',
            'OMEGATL',
            'PARAM1',
            'PARAM2',
            'PFLAT',
            'PHON_BORN_CHARGES',
            'PHON_DIELECTRIC',
            'PHON_DOS',
            'PHON_G_CUTOFF',
            'PHON_LBOSE',
            'PHON_LMC',
            'PHON_NEDOS',
            'PHON_NSTRUCT',
            'PHON_NTLIST',
            'PHON_NWRITE',
            'PHON_SIGMA',
            'PHON_TLIST',
            'PLEVEL',
            'PMASS',
            'POMASS',
            'POTIM',
            'PREC',
            'PRECFOCK',
            'Profiling',
            'PROUTINE',
            'PSTRESS',
            'PSUBSYS',
            'PTHRESHOLD',
            'QMAXFOCKAE',
            'QSPIRAL',
            'QUAD_EFG',
            'RANDOM_SEED',
            'ROPT',
            'RWIGS',
            'SAXIS',
            'SCALEE',
            'SCSRAD',
            'SHAKEMAXITER',
            'SHAKETOL',
            'SIGMA',
            'SMASS',
            'SMEARINGS',
            'SPRING',
            'STEP_MAX',
            'STEP_SIZE',
            'STOP_ON',
            'SYMPREC',
            'SYSTEM',
            'TEBEG',
            'TEEND',
            'TIME',
            'TSUBSYS',
            'VALUE_MAX',
            'VALUE_MIN',
            'VCA',
            'VCAIMAGES',
            'VCUTOFF',
            'VDW_A1',
            'VDW_A2',
            'VDW_ALPHA',
            'VDW_C6',
            'VDW_C6AU',
            'VDW_CNRADIUS',
            'VDW_D',
            'VDW_R0',
            'VDW_R0AU',
            'VDW_RADIUS',
            'VDW_S6',
            'VDW_S8',
            'VDW_SR',
            'VOSKOWN',
            'WANNIER90_WIN',
            'WC',
            'WEIMIN',
            'ZAB_VDW',
            'ZVAL'
        ]
        if key in valid_list:
            return True
        else:
            return False
